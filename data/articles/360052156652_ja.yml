id: 360052156652
url: https://circleci.zendesk.com/api/v2/help_center/ja/articles/360052156652.json
html_url: https://support.circleci.com/hc/ja/articles/360052156652
author_id: 405001866574
comments_disabled: false
draft: false
promoted: false
position: 0
vote_sum: 0
vote_count: 0
section_id: 115003755807
created_at: '2020-11-16T18:43:20Z'
updated_at: '2021-02-04T05:56:50Z'
name: SSH によるジョブの再実行時にステップを実行またはスキップする方法
title: SSH によるジョブの再実行時にステップを実行またはスキップする方法
source_locale: en-us
locale: ja
outdated: false
outdated_locales: []
edited_at: '2021-02-04T05:56:50Z'
user_segment_id: null
permission_group_id: 237867
label_names:
  - rerun with ssh
body: "<p>SSH でジョブが再実行されるときに、特定のステップだけを実行またはスキップしたいことがあります。 <code>netstat</code> を使用して<span>アクティブな TCP 接続を確認することで、こうしたステップを指定できます。 SSH でジョブが再実行されているときは、<code>circleci-agent</code> が <code>PID/Program Name</code> になります。 以下のコード スニペットを使用することで、SSH でジョブが再実行されるときに特定のステップを条件付きで実行またはスキップすることができます。\_</span></p><h3><span>SSH でジョブが再実行されるときにステップをスキップする方法: </span></h3><p>\_</p><pre><span> - run: |<br>     if [[ $(netstat -tnlp | grep -F 'circleci-agent') ]] ; then<br>       exit 0;<br>     fi<br>     echo \"commands you want to run when job is NOT rerun with SSH\"</span></pre><p>上記のコードの <code>echo \"commands you want to run when job is NOT rerun with SSH\"</code>\_は、ジョブが SSH で再実行 \"されない\" ときにのみ実行されます。 ジョブが SSH で再実行される場合、このステップはコード 0 で終了し、通知はされません。 これは、ステップの実行の成否がビルドのステータスに影響しないということを意味します。</p><p>\_</p><h3>SSH でジョブが再実行されるときにのみステップを実行する方法: </h3><pre><span> - run: |<br>     if [[ $(netstat -tnlp | grep -F 'circleci-agent') ]] ; then<br>       echo \"commands you want to run ONLY when job is rerun with SSH\"    <br>     fi<br>     exit 0;</span></pre><p>\_</p>"
