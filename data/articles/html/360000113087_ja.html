<p>テストスイートで、Docker ブートストラップレース状況に陥ることがあります。 テストスイートは、必要なすべてのサービスがブートストラップを完全に終了するまで開始しません。 これには通常、コンテナの単純なスタートアップよりも実行のほうが多く含まれることに注意してください。 一部の DB イメージは、コンテナの開始時にデフォルトのデータベースとテーブルを作成します。 Selenium コンテナでは、ブラウザーを起動するために多少の時間を要することがあります。</p>
<p>コンテナのブートストラップ処理を管理するツールとして、dockerize: <a href="https://github.com/jwilder/dockerize" target="_blank" rel="noopener">https://github.com/jwilder/dockerize</a> をおすすめします。 `-wait` サブコマンドは、スリープループでコマンドを実行し、ブートストラップが完了しているかテストします。 それぞれのコンテナのブースストラップが完了したことをテストするため、適切なコマンドが何かを判定する必要があります。</p>
<p>例: https://discuss.circleci.com/t/prevent-race-conditions-by-waiting-for-services-with-dockerize/11215</p>
<p> </p>
<p>他にも Wait Port というユーティリティが便利です：<a href="https://github.com/dwmkerr/wait-port" target="_blank" rel="noopener">https://github.com/dwmkerr/wait-port</a></p>