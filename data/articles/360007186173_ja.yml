id: 360007186173
url: https://circleci.zendesk.com/api/v2/help_center/ja/articles/360007186173.json
html_url: https://support.circleci.com/hc/ja/articles/360007186173
author_id: 25261361207
comments_disabled: false
draft: false
promoted: false
position: 0
vote_sum: -2
vote_count: 2
section_id: 115003756627
created_at: '2018-07-17T15:13:25Z'
updated_at: '2020-10-22T06:59:08Z'
name: Docker executor サービスコンテナとのポート競合
title: Docker executor サービスコンテナとのポート競合
source_locale: en-us
locale: ja
outdated: false
outdated_locales: []
edited_at: '2018-11-13T06:15:26Z'
user_segment_id: null
permission_group_id: 237867
label_names: []
body: "<p>CircleCI では、いくつものサービスコンテナを利用できるので、ジョブの実行時にコンテナのポートを変更することはできません。 <span style=\"background-color: #f6d5d9;\">CircleCI</span> は、コンテナのポートを自動的に <strong>localhost</strong> へバインドします。そのため、複数のサービスコンテナが同じポートを必要とする場合に問題が発生します。 例えば、postgres データベースが 2 つある場合などです。 次の例について考えてみます。</p>\n<p>version: 2<br>jobs:<br> build:<br> # プライマリコンテナは、リストされている最初のイメージのインスタンスです。<br> docker:<br> - image: circleci/node:4.8.2-jessie<br><strong> - image: postgres</strong><strong>:11-alpine-ram</strong><br><strong> - image: postgres:11-alpine-ram</strong><br><br>両方の postgres サービスイメージが、localhost:5432 へのバインドを試み、エラーを引き起こします。 これを防止するには、イメージポートのバインド先のホスト名として使用する名前を、イメージに指定します。</p>\n<p>\_ docker:<br>\_ \_ - image: circleci/node:4.8.2-jessie<br>\_ \_ - image: postgres:11-alpine-ram<br><strong>\_ \_ - image: postgres:11-alpine-ram</strong><br><strong>\_ \_ \_ \_ name: postgres2</strong></p>\n<p>name パラメーターを指定することで、2 番目のコンテナは <strong>postgres2:5432</strong> から、最初の postgres コンテナは <strong>localhost:5432<br><br></strong> からアクセスできるようになります。</p>\n<p>関連情報<br><a href=\"https://circleci.com/docs/2.0/configuration-reference/#docker\">https://circleci.com/docs/2.0/configuration-reference/#docker</a></p>"
