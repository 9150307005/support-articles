id: 360056546792
url: >-
  https://circleci.zendesk.com/api/v2/help_center/en-us/articles/360056546792.json
html_url: >-
  https://support.circleci.com/hc/en-us/articles/360056546792-Conditionally-utilize-different-Xcode-provisioning-profiles
author_id: 405652843914
comments_disabled: true
draft: false
promoted: false
position: 0
vote_sum: 0
vote_count: 0
section_id: 115003327088
created_at: '2021-02-11T16:27:36Z'
updated_at: '2021-02-24T18:18:18Z'
name: Conditionally utilize different Xcode provisioning profiles
title: Conditionally utilize different Xcode provisioning profiles
source_locale: en-us
locale: en-us
outdated: false
outdated_locales: []
edited_at: '2021-02-24T18:18:18Z'
user_segment_id: null
permission_group_id: 237847
label_names:
  - fastlane
  - macos
  - app store
  - ad-hoc
body: >-
  <p>You may have a situation where you want a build on a specific branch to
  deploy to the App Store, while all other branches deploy as ad-hoc. This can
  be accomplished with Fastlane and setting specific profiles using
  <code>PROVISIONING_PROFILE_SPECIFIER</code>.</p>

  <h2>Fastlane setup</h2>

  <p>Then you can adjust your Fastfile to have an if/else conditional like the
  following:</p>

  <pre style="background-color: #f3f3f3;"># fastlane/Fastfile

  default_platform(:ios)


  platform :ios do
    before_all do
      setup_circle_ci
    end

    desc "Runs tests and build the app"
    lane :testandbuild do |options|
      if(options[:branch] == "main")
        match(type: "appstore", readonly: "false")
        build_app
      else
         match(type: "adhoc")
         gym(export_method: "ad-hoc")
      end       
    end
  end</pre>

  <p>Beyond the above you will also need to specify the
  <code>PROVISIONING_PROFILE_SPECIFIER</code>, information on that here:</p>

  <p><a
  href="https://docs.fastlane.tools/codesigning/xcode-project/#build-settings">https://docs.fastlane.tools/codesigning/xcode-project/#build-settings</a></p>

  <p>Once the above is done it is just a matter of passing in the branch as an
  option to your Fastlane run command. Like the following:</p>

  <pre style="background-color: #f3f3f3;">- run: bundle exec fastlane ios
  testandbuild branch:${CIRCLE_BRANCH}</pre>
